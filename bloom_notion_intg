// Set up variables for Bloom.io API and Notion database
const bloomApi = 'YOUR_BLOOM_API_KEY';
const notionDbId = 'ID_OF_YOUR_NOTION_DATABASE';

// Function to check if an email response has been received from a client
function checkResponseReceived(requestDate) {
  // Use the request date to find the corresponding row in your Notion database
  const db = notion.pages[notionDbId].database;
  const rows = db.getRows();
  for (const row of rows) {
    if (row.properties.Request Date.date === requestDate) {
      return !row.properties.Response Received?.checkbox; // Return true if no response has been received
    }
  }
  return null; // If the request date is not found, return null
}

// Function to send a follow-up email using Bloom.io API
function sendFollowUpEmail(requestId) {
  const bloomApiUrl = `https://api.bloom.io/v1/requests/${requestId}/follow_up`;
  fetch(bloomApiUrl, {
    method: 'POST',
    headers: { 'Authorization': `Bearer ${bloomApi}` },
  })
  .then(response => response.json())
  .catch(error => console.error('Error sending follow-up email:', error));
}

// Main script logic
function main() {
  // Get the current date and time
  const now = new Date();
  
  // Loop through all requests in your Notion database that have not received a response yet
  db.getRows().forEach((row) => {
    if (checkResponseReceived(row.properties.Request Date.date)) {
      sendFollowUpEmail(requestId); // Send the follow-up email using Bloom.io API
    }
  });
}

// Run the main script every hour to check for new requests and send follow-ups as needed
setInterval(main, 3600000); 
